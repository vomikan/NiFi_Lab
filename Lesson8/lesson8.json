{"flowContents":{"identifier":"02308c43-1435-36ca-a0cc-baeafe653168","instanceIdentifier":"36f3693a-0194-1000-1fbb-68c0eb965321","name":"lesson8","comments":"Unescape JSON","position":{"x":-48.0,"y":224.0},"processGroups":[],"remoteProcessGroups":[],"processors":[{"identifier":"15cffafd-6dde-3545-95c7-30fdf6d5f332","instanceIdentifier":"374c498a-0194-1000-b7be-7588795f0667","name":"GenerateFlowFile","comments":"","position":{"x":-816.0,"y":-208.0},"type":"org.apache.nifi.processors.standard.GenerateFlowFile","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.1.0"},"properties":{"character-set":"UTF-8","File Size":"0B","mime-type":"application/json","generate-ff-custom-text":"{\n  \"type\": \"Справочник.ФизическиеЛица\",\n  \"deletionMark\": \"false\",\n  \"contactInfo\": [\n    {\n      \"type\": \"Телефон\",\n      \"valueJSON\": \"{\\r\\n\\\"value\\\": \\\"+799990799099\\\",\\r\\n\\\"type\\\": \\\"Телефон\\\",\\r\\n\\\"countryCode\\\": \\\"7\\\"\\r\\n}\"\n    }\n  ]\n}","Batch Size":"1","Unique FlowFiles":"false","Data Format":"Text"},"propertyDescriptors":{"character-set":{"name":"character-set","displayName":"Character Set","identifiesControllerService":false,"sensitive":false,"dynamic":false},"File Size":{"name":"File Size","displayName":"File Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"mime-type":{"name":"mime-type","displayName":"Mime Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"generate-ff-custom-text":{"name":"generate-ff-custom-text","displayName":"Custom Text","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Batch Size":{"name":"Batch Size","displayName":"Batch Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Unique FlowFiles":{"name":"Unique FlowFiles","displayName":"Unique FlowFiles","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Data Format":{"name":"Data Format","displayName":"Data Format","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"1 min","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":[],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"fe20df9b-6af4-3026-8841-6d30e7120f35","instanceIdentifier":"374d2021-0194-1000-b48a-60598da37f01","name":"JSLTTransformJSON","comments":"","position":{"x":-208.0,"y":-208.0},"type":"org.apache.nifi.processors.jslt.JSLTTransformJSON","bundle":{"group":"org.apache.nifi","artifact":"nifi-jslt-nar","version":"2.1.0"},"properties":{"jslt-transform-pretty_print":"false","jslt-transform-result-filter":". != null and . != {} and . != []","jslt-transform-transformation":"{\n  \"type\": .type,\n  \"deletionMark\": .deletionMark,\n  \"contactInfo\": [ for (.contactInfo)\n                       from-json(.valueJSON)\n                 ]\n}","jslt-transform-cache-size":"1","jslt-transform-transformation-strategy":"EACH_OBJECT"},"propertyDescriptors":{"jslt-transform-pretty_print":{"name":"jslt-transform-pretty_print","displayName":"Pretty Print","identifiesControllerService":false,"sensitive":false,"dynamic":false},"jslt-transform-result-filter":{"name":"jslt-transform-result-filter","displayName":"Transform Result Filter","identifiesControllerService":false,"sensitive":false,"dynamic":false},"jslt-transform-transformation":{"name":"jslt-transform-transformation","displayName":"JSLT Transformation","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["TEXT","FILE"]}},"jslt-transform-cache-size":{"name":"jslt-transform-cache-size","displayName":"Transform Cache Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"jslt-transform-transformation-strategy":{"name":"jslt-transform-transformation-strategy","displayName":"Transformation Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"ad9f4c9e-9acb-38f8-b113-980c57a75cc1","instanceIdentifier":"36f442e4-0194-1000-a9a0-9bc9d40c328b","name":"ExecuteGroovyScript","comments":"","position":{"x":-208.0,"y":-72.0},"type":"org.apache.nifi.processors.groovyx.ExecuteGroovyScript","bundle":{"group":"org.apache.nifi","artifact":"nifi-groovyx-nar","version":"2.1.0"},"properties":{"groovyx-script-body":"import groovy.json.JsonSlurper\nimport groovy.json.JsonOutput\n\ndef flowFile = session.get()\nif (!flowFile) return\n\ntry {\n  flowFile = session.write(flowFile, { rawIn, rawOut ->\n    def parsedJson = new JsonSlurper().parse(rawIn, 'UTF-8')\n\n    parsedJson.contactInfo = parsedJson.contactInfo.collect { item ->\n    if (item.valueJSON) {\n        item = new JsonSlurper().parseText(item.valueJSON)\n        item\n      }\n    }\n\n    def outputJson = JsonOutput.toJson(parsedJson)\n    rawOut.withWriter('UTF-8') { it.write(outputJson) }\n  } as StreamCallback)\n\n  session.transfer(flowFile, REL_SUCCESS)\n} catch (ex) {\n  flowFile = session.putAttribute(flowFile, \"script.error_message\", ex.getMessage())\n  flowFile = session.putAttribute(flowFile, \"script.error\", ex.toString())\n  session.transfer(flowFile, REL_FAILURE)\n}","groovyx-failure-strategy":"rollback","groovyx-additional-classpath":null,"groovyx-script-file":null},"propertyDescriptors":{"groovyx-script-body":{"name":"groovyx-script-body","displayName":"Script Body","identifiesControllerService":false,"sensitive":false,"dynamic":false},"groovyx-failure-strategy":{"name":"groovyx-failure-strategy","displayName":"Failure strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"groovyx-additional-classpath":{"name":"groovyx-additional-classpath","displayName":"Additional classpath","identifiesControllerService":false,"sensitive":false,"dynamic":false},"groovyx-script-file":{"name":"groovyx-script-file","displayName":"Script File","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["FILE"]}}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"}],"inputPorts":[],"outputPorts":[],"connections":[{"identifier":"2dd27dc0-cf3d-3937-8dba-3fe6e45308e5","instanceIdentifier":"374d32a5-0194-1000-dd1b-fea3798005bb","name":"","source":{"id":"15cffafd-6dde-3545-95c7-30fdf6d5f332","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"GenerateFlowFile","comments":"","instanceIdentifier":"374c498a-0194-1000-b7be-7588795f0667"},"destination":{"id":"fe20df9b-6af4-3026-8841-6d30e7120f35","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"JSLTTransformJSON","comments":"","instanceIdentifier":"374d2021-0194-1000-b48a-60598da37f01"},"labelIndex":0,"zIndex":0,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"38748422-0df3-3293-92f5-908b9ed0b7eb","instanceIdentifier":"3776dce4-0194-1000-0bb5-1c918f4386af","name":"","source":{"id":"ad9f4c9e-9acb-38f8-b113-980c57a75cc1","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"ExecuteGroovyScript","comments":"","instanceIdentifier":"36f442e4-0194-1000-a9a0-9bc9d40c328b"},"destination":{"id":"8087327a-c778-34b1-adc7-5e5d65bca500","type":"FUNNEL","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"Funnel","comments":"","instanceIdentifier":"36f7b64b-0194-1000-365b-e67a550f8048"},"labelIndex":0,"zIndex":0,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"a173a7b9-5229-3901-b277-c88cfdfbba17","instanceIdentifier":"3776bf59-0194-1000-da98-00501ae7dc5f","name":"","source":{"id":"15cffafd-6dde-3545-95c7-30fdf6d5f332","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"GenerateFlowFile","comments":"","instanceIdentifier":"374c498a-0194-1000-b7be-7588795f0667"},"destination":{"id":"ad9f4c9e-9acb-38f8-b113-980c57a75cc1","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"ExecuteGroovyScript","comments":"","instanceIdentifier":"36f442e4-0194-1000-a9a0-9bc9d40c328b"},"labelIndex":0,"zIndex":0,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"50134adb-aff7-3f9d-8510-19d866b6f521","instanceIdentifier":"374d5475-0194-1000-fd0f-117ebad1281f","name":"","source":{"id":"fe20df9b-6af4-3026-8841-6d30e7120f35","type":"PROCESSOR","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"JSLTTransformJSON","comments":"","instanceIdentifier":"374d2021-0194-1000-b48a-60598da37f01"},"destination":{"id":"024aa461-de2e-35a3-8946-0dddfcc016db","type":"FUNNEL","groupId":"02308c43-1435-36ca-a0cc-baeafe653168","name":"Funnel","comments":"","instanceIdentifier":"36fae397-0194-1000-8279-4807df1790c2"},"labelIndex":0,"zIndex":0,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"}],"labels":[],"funnels":[{"identifier":"024aa461-de2e-35a3-8946-0dddfcc016db","instanceIdentifier":"36fae397-0194-1000-8279-4807df1790c2","position":{"x":408.0,"y":-168.0},"componentType":"FUNNEL","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"},{"identifier":"8087327a-c778-34b1-adc7-5e5d65bca500","instanceIdentifier":"36f7b64b-0194-1000-365b-e67a550f8048","position":{"x":408.0,"y":-32.0},"componentType":"FUNNEL","groupIdentifier":"02308c43-1435-36ca-a0cc-baeafe653168"}],"controllerServices":[],"defaultFlowFileExpiration":"0 sec","defaultBackPressureObjectThreshold":10000,"defaultBackPressureDataSizeThreshold":"1 GB","scheduledState":"ENABLED","executionEngine":"INHERITED","maxConcurrentTasks":1,"statelessFlowTimeout":"1 min","componentType":"PROCESS_GROUP","flowFileConcurrency":"UNBOUNDED","flowFileOutboundPolicy":"STREAM_WHEN_AVAILABLE"},"externalControllerServices":{},"parameterContexts":{},"flowEncodingVersion":"1.0","parameterProviders":{},"latest":false}