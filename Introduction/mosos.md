# Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ˜ Ð˜ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ Ð¡ÐŸÐž APACHE NiFi (Ð²ÐµÑ€ÑÐ¸Ñ 2.5.0)

### 1.1 ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚

Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸, Ñ€Ð°ÑÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸ Ð¸ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹:

~~~bash
# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
sudo zypper refresh
sudo zypper update -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚
sudo zypper install -y wget unzip tar gzip nano curl procps
~~~

> ðŸ’¡ **ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:**  
> - Ð’ ÐœÐžÐ¡.ÐžÐ¡ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ð°ÐºÐµÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ `zypper` (Ð°Ð½Ð°Ð»Ð¾Ð³ `dnf` Ð² RHEL Ð¸Ð»Ð¸ `apt` Ð² Debian).  
> - Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ `nano`, `wget`, `unzip` â€” Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹ Ð´Ð»Ñ ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ Ð´Ð¸ÑÑ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¸Ð²Ð° Ð¸ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð².


### 1.2 Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÐžÐ¡

Ð”Ð»Ñ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹ Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Apache NiFi 2.5.0 Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ ÐœÐžÐ¡.ÐžÐ¡, Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‰ÑƒÑŽ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð² Ð¸ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² ÑÐ´Ñ€Ð°.

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸ÑÐ¼ Apache NiFi Ð¸ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¿Ð¾Ð´ SUSE-ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ñ‹Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹.

#### 1.2.1 Ð›Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¸ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²

NiFi Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¸ ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹. Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, Ð¾Ñ‚ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ NiFi (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `nifi`).

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð»:

```bash
sudo nano /etc/security/limits.conf
```

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸:

```conf
# Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ nifi
nifi    soft    nofile    50000
nifi    hard    nofile    50000
nifi    soft    nproc     10000
nifi    hard    nproc     10000

# ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾: Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
*       soft    nofile    50000
*       hard    nofile    50000
*       soft    nproc     10000
*       hard    nproc     10000
```

> âœ… **Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ:**  
> Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ `nifi`:
> ```bash
> sudo useradd -m -s /bin/bash nifi
> ```

> ðŸ’¡ **Ð’Ð°Ð¶Ð½Ð¾:**  
> Ð›Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð½Ð¾Ð²Ð¾Ð¼ Ð²Ñ…Ð¾Ð´Ðµ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ. ÐŸÐµÑ€ÐµÐ·Ð°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ð¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ `nifi`, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð²ÑÑ‚ÑƒÐ¿Ð¸Ð»Ð¸.

#### 1.2.2 ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² ÑÐ´Ñ€Ð°

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ ÑÐ´Ñ€Ð°:

```bash
sudo nano /etc/sysctl.conf
```

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¸Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:

```conf
# Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² (Ð´Ð»Ñ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð° Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹)
net.ipv4.ip_local_port_range = 10000 65000

# ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑÐ²Ð¾Ð¿Ð¸Ð½Ð³Ð° (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾Ð¼ Ð¾Ð±ÑŠÑ‘Ð¼Ðµ RAM)
vm.swappiness = 0

# Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸
net.core.somaxconn = 1000

# Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ SYN-Ñ„Ð»ÑƒÐ´ Ð°Ñ‚Ð°Ðº
net.ipv4.tcp_syncookies = 1

# Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð±ÑƒÑ„ÐµÑ€Ð¾Ð² ÑÐµÑ‚Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¹ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸)
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216
```

ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:

```bash
sudo sysctl -p
```

> âš ï¸ **ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:**  
> ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ `vm.swappiness = 0` Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð·Ð±ÐµÐ³Ð°Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ swap.  
> Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ð¹Ñ‚Ðµ ÐµÐ³Ð¾, ÐµÑÐ»Ð¸ Ñƒ ÑÐµÑ€Ð²ÐµÑ€Ð° **Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ RAM (16 Ð“Ð‘ Ð¸ Ð±Ð¾Ð»ÐµÐµ)**.  
> ÐŸÑ€Ð¸ Ð¼Ð°Ð»Ð¾Ð¼ Ð¾Ð±ÑŠÑ‘Ð¼Ðµ RAM â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `vm.swappiness = 1`.

#### 1.2.3 ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº

ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ…Ð¾Ð´Ð° Ð¿Ð¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ `nifi` Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ñ‹:

```bash
ulimit -n    # Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 50000
ulimit -u    # Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 10000
```

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² ÑÐ´Ñ€Ð°:

```bash
sysctl net.ipv4.ip_local_port_range
sysctl vm.swappiness
```

### 1.3 Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° OpenJDK 21

Apache NiFi 2.5.0 Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ **Java 21**. Ð’ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð°ÐºÐµÑ‚ `java-21-openjdk` Ð¸Ð· Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ.

#### 1. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²

```bash
sudo zypper refresh
```

#### 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ OpenJDK 21

Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:
- `java-21-openjdk-headless` â€” JVM Ð±ÐµÐ· GUI
- `java-21-openjdk-devel` â€” Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ (javac, jstat Ð¸ Ð´Ñ€.)

```bash
sudo zypper install java-21-openjdk-devel java-21-openjdk-headless
```

> ðŸ’¡ ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… **ÐÐ¢ (ÐÑÑ‚Ñ€Ð° Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸)** â€” Ð²ÐµÑ€ÑÐ¸Ñ `21.0.3.0-at154.1.1`.

#### 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÑƒ

```bash
java -version
javac -version
```

ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´:
```
openjdk version "21.0.3" 2024-04-16
OpenJDK Runtime Environment AstraLinux (build 21.0.3+0-154)
OpenJDK 64-Bit Server VM AstraLinux (build 21.0.3+0-154, mixed mode)
```

#### 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° JAVA_HOME

ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿ÑƒÑ‚ÑŒ Ðº JDK:

```bash
readlink -f $(which java)
# ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð²Ñ‹Ð²Ð¾Ð´Ð°: /usr/lib64/jvm/java-21-openjdk/bin/java
```

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³ ÐºÐ°Ðº `JAVA_HOME`.

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:

```bash
sudo nano /etc/profile.d/java.sh
```

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ:

```bash
export JAVA_HOME=/usr/lib64/jvm/java-21-openjdk
export PATH=$JAVA_HOME/bin:$PATH
```

ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚Ðµ:

```bash
source /etc/profile.d/java.sh
```

> âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ:
> ```bash
> echo $JAVA_HOME
> ```
