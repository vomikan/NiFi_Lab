# Пайплайны в NiFi для работы с файловой системой

## 1. Пайплайн для генерации файлов

### Описание
Этот пайплайн генерирует 10 000 файлов со случайным содержимым и распределяет их по подпапкам в заданной директории. Подпапки имеют названия от 1 до 100.

### Компоненты:
- **GenerateFlowFile**: Генерирует FlowFile, который служит триггером для создания файлов.
- **ExecuteScript** (или **InvokeScriptedProcessor**): Используется для создания файлов с рандомным содержимым и их распределения по подпапкам.
  - Скрипт создаёт файлы с именами, основанными на UUID, и записывает в них случайные данные.
  - Файлы распределяются по подпапкам (от 1 до 100) внутри заданной директории.
- **PutFile**: Сохраняет сгенерированные файлы в указанную директорию.

### Пример структуры директории:

```
/target_folder/
├── 1/
│ ├── file1.txt
│ ├── file2.txt
│ └── ...
├── 2/
│ ├── file3.txt
│ └── ...
└── ...
```


---

## 2. Пайплайн для чтения файлов с использованием ListFile

### Описание
Этот пайплайн использует процессор `ListFile` для получения списка файлов в заданной директории и её поддиректориях.

### Компоненты:
- **ListFile**: Сканирует директорию и создаёт FlowFile для каждого найденного файла.
  - Атрибуты FlowFile содержат информацию о файле (имя, путь, размер и т.д.).
- **FetchFile**: Читает содержимое файлов на основе данных, созданных `ListFile`.

### Особенности:
- Простота настройки.
- Подходит для небольшого колличества файлов.
- Может потреблять значительные ресурсы при большом количестве файлов.

---

## 3. Пайплайн для чтения файлов с использованием ListFile и CSVRecordSetWriter

### Описание
Этот пайплайн также использует `ListFile`, но записывает результат в формате CSV с помощью `Record Writer`.

### Компоненты:
- **ListFile**: Сканирует директорию и создаёт FlowFile с информацией о файлах.
- **Record Writer (CSVRecordSetWriter)**: Преобразует список файлов в CSV-формат.
  - Каждая строка CSV содержит информацию о файле (имя, путь, размер и т.д.).
- **FetchFile**: Читает содержимое файлов на основе CSV-списка.

### Особенности:
- Удобен для экспорта списка файлов в CSV.
- Подходит для интеграции с другими системами, которые работают с CSV.

---

## 4. Пайплайн для чтения файлов с использованием скрипта

### Описание
Этот пайплайн использует скрипт на Groovy для составления списка каталогов и их последующего чтения.

### Компоненты:
- **ExecuteScript**: Используется для составления списка каталогов рекурсивно.
- Скрипт создаст флоуфайлов по колличеству директорий.
- Другой скрипт читает путь к папке из формирует флоуфайл для каждого файла в этой директории (без рекурсии)
- **FetchFile**: Читает содержимое файлов на основе списка, созданного скриптом.

### Особенности:
- Гибкость: можно настроить скрипт для фильтрации файлов по определённым критериям.
- Меньше нагрузки на ресурсы по сравнению с `ListFile`.
- Подходит для больших объёмов данных.

---

## 5. Пайплайн для чтения файлов с использованием ExecuteStreamCommand

### Описание
Этот пайплайн использует команды операционной системы (например, `dir` в Windows или `find` в Linux) для составления списка файлов.

### Компоненты:
- **ExecuteStreamCommand**: Выполняет команду ОС для получения списка файлов.
  - Пример команды для Windows:
    ```cmd
    cmd /c "dir /b /s *.txt"
    ```
  - Пример команды для Linux:
    ```bash
    find /target_folder -type f -name "*.txt"
    ```
- **FetchFile**: Читает содержимое файлов на основе списка, созданного командой ОС.

### Особенности:
- Очень высокая производительность.
- Минимальное использование ресурсов NiFi.
- Подходит для обработки огромных объёмов данных.

---

## Сравнение пайплайнов

| Пайплайн                     | Простота | Производительность | Ресурсы | Гибкость |
|------------------------------|----------|--------------------|---------|----------|
| ListFile                     | Высокая  | Низкая             | Высокие | Низкая   |
| ListFile + CSVRecordSetWriter | Средняя  | Низкая            | Высокие | Средняя  |
| Чтение через скрипт          | Средняя  | Высокая            | Низкие  | Высокая  |
| ExecuteStreamCommand         | Низкая  | Высокая      | Низкие  | Высокая   |

---

## Рекомендации
- Для **генерации файлов** используйте первый пайплайн.
- Для **простого чтения файлов** подойдёт второй пайплайн.
- Для **экспорта списка файлов** в CSV используйте третий пайплайн.
- Для **обработки большого колличества файлов** с минимальной тратой ресурсов используйте четвёртый или пятый пайплайн.
- Обратите внимание на использование процессоров Split и настройку Back Pressure Object Threshold в очередях
